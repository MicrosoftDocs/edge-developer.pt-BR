---
description: Use o mecanismo JavaScript Chakra baseado em padrões para adicionar recursos de script ao seu aplicativo do Windows.
title: Hospedando o Runtime do JavaScript
ms.date: 06/18/2020
ms.prod: microsoft-edge
ms.topic: article
ms.assetid: 30ec744e-57cc-4ef5-8fe1-d2c27b946548
caps.latest.revision: 14
author: MSEdgeTeam
ms.author: msedgedevrel
ms.openlocfilehash: 043f7ecd174515ce407d2fc0c2bbe796fa2750a5
ms.sourcegitcommit: 037a2d62333691104c9accb4862968f80a3465a2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/18/2020
ms.locfileid: "10752245"
---
# <span data-ttu-id="abd67-103">Hospedando o tempo de execução JavaScript</span><span class="sxs-lookup"><span data-stu-id="abd67-103">Hosting the JavaScript runtime</span></span>  

[!INCLUDE [deprecation-note](../includes/deprecation-note.md)]  

<span data-ttu-id="abd67-104">As APIs do tempo de execução do JavaScript (JsRT) fornecem uma maneira para aplicativos da área de trabalho, da Windows Store e do servidor em execução no sistema operacional Windows para adicionar recursos de script ao aplicativo usando o mecanismo JavaScript Chakra baseado em padrões, que também é usado pelo Microsoft Edge e pelo Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="abd67-104">The JavaScript Runtime (JsRT) APIs provide a way for desktop, Windows Store, and server-side applications running on the Windows operating system to add scripting capabilities to the application by using the standards-based Chakra JavaScript engine that is also utilized by Microsoft Edge and Internet Explorer.</span></span> <span data-ttu-id="abd67-105">Essas APIs estão disponíveis no Windows 10 e em qualquer versão do sistema operacional Windows que tenha o Internet Explorer versão 11,0 instalado no computador.</span><span class="sxs-lookup"><span data-stu-id="abd67-105">These APIs are available on Windows 10 and any version of the Windows operating system that has Internet Explorer version 11.0 installed on the machine.</span></span> <span data-ttu-id="abd67-106">Para obter mais informações, consulte [referência (JavaScript Runtime)](../chakra-hosting/reference-javascript-runtime.md).</span><span class="sxs-lookup"><span data-stu-id="abd67-106">For more info, see [Reference (JavaScript Runtime)](../chakra-hosting/reference-javascript-runtime.md).</span></span> <span data-ttu-id="abd67-107">Para obter informações sobre como usar o JsRT em aplicativos da Windows Store, consulte [JsRT e a plataforma universal do Windows](#Windows).</span><span class="sxs-lookup"><span data-stu-id="abd67-107">For info on using the JsRT in Windows Store apps, see [JsRT and the Universal Windows Platform](#Windows).</span></span>  

> [!NOTE]
> <span data-ttu-id="abd67-108">Esta documentação pressupõe uma familiaridade de trabalho geral com a linguagem JavaScript.</span><span class="sxs-lookup"><span data-stu-id="abd67-108">This documentation assumes a general working familiarity with the JavaScript language.</span></span>  

## <span data-ttu-id="abd67-109">Conceitos</span><span class="sxs-lookup"><span data-stu-id="abd67-109">Concepts</span></span>  

<span data-ttu-id="abd67-110">Entender como hospedar o mecanismo JavaScript usando as APIs JsRT depende de dois conceitos chave: runtimes e contextos de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-110">Understanding how to host the JavaScript engine using the JsRT APIs depends on two key concepts: runtimes and execution contexts.</span></span>  

<span data-ttu-id="abd67-111">Um *tempo de execução* representa um ambiente de execução JavaScript completo.</span><span class="sxs-lookup"><span data-stu-id="abd67-111">A *runtime* represents a complete JavaScript execution environment.</span></span> <span data-ttu-id="abd67-112">Cada tempo de execução que é criado tem seu próprio heap de coleta de lixo isolado e, por padrão, seu próprio thread de compilador just-in-time (JIT) e o coletor de lixo (GC).</span><span class="sxs-lookup"><span data-stu-id="abd67-112">Each runtime that is created has its own isolated garbage collected heap and, by default, its own just-in-time (JIT) compiler thread and garbage collector (GC) thread.</span></span> <span data-ttu-id="abd67-113">Um *contexto de execução* representa um ambiente JavaScript que tem seu próprio objeto global JavaScript distinto de todos os outros contextos de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-113">An *execution context* represents a JavaScript environment that has its own JavaScript global object distinct from all other execution contexts.</span></span> <span data-ttu-id="abd67-114">Um tempo de execução pode conter vários contextos de execução e, nesses casos, todos os contextos de execução compartilham o compilador JIT e o thread GC associado ao Runtime.</span><span class="sxs-lookup"><span data-stu-id="abd67-114">One runtime may contain multiple execution contexts, and in such cases, all the execution contexts share the JIT compiler and GC thread associated with the runtime.</span></span>  

<span data-ttu-id="abd67-115">Os tempos de execução representam um único thread de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-115">Runtimes represent a single thread of execution.</span></span> <span data-ttu-id="abd67-116">Somente um tempo de execução pode estar ativo em um thread específico de cada vez, e um tempo de execução só pode estar ativo em um thread de cada vez.</span><span class="sxs-lookup"><span data-stu-id="abd67-116">Only one runtime can be active on a particular thread at a time, and a runtime can only be active on one thread at a time.</span></span> <span data-ttu-id="abd67-117">Os tempos de execução são alugados threads, portanto, um tempo de execução que não está ativo no momento em um thread (ou seja, não está executando qualquer código JavaScript ou respondendo a chamadas do host) pode ser usado em qualquer thread que ainda não tenha um tempo de execução ativo.</span><span class="sxs-lookup"><span data-stu-id="abd67-117">Runtimes are rental threaded, so a runtime that is not currently active on a thread (i.e. isn't running any JavaScript code or responding to any calls from the host) can be used on any thread that doesn't already have an active runtime on it.</span></span>  

<span data-ttu-id="abd67-118">Os contextos de execução estão ligados a um tempo de execução específico e executar o código dentro desse tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-118">Execution contexts are tied to a particular runtime and execute code within that runtime.</span></span> <span data-ttu-id="abd67-119">Ao contrário dos tempos de execução, vários contextos de execução podem ficar ativos em um thread ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="abd67-119">Unlike runtimes, multiple execution contexts can be active on a thread at the same time.</span></span> <span data-ttu-id="abd67-120">Para que um host possa fazer uma chamada em um contexto de execução, esse contexto de execução pode retornar a chamada para o host, e o host pode fazer uma chamada em um contexto de execução diferente.</span><span class="sxs-lookup"><span data-stu-id="abd67-120">So a host can make a call into an execution context, that execution context can call back to the host, and the host can make a call into a different execution context.</span></span>  

![Vários contextos de execução](../chakra-hosting/media/js-chakra-hosting.png "JS_Chakra_Hosting")  

<span data-ttu-id="abd67-122">Na prática, a menos que um host precise executar o código em ambientes separados, um único contexto de execução pode ser usado.</span><span class="sxs-lookup"><span data-stu-id="abd67-122">In practice, unless a host needs to run code in separated environments, a single execution context can be used.</span></span> <span data-ttu-id="abd67-123">Da mesma forma, a menos que um host precise executar várias partes de código simultaneamente, um único tempo de execução é suficiente.</span><span class="sxs-lookup"><span data-stu-id="abd67-123">Similarly, unless a host needs to run multiple pieces of code concurrently, a single runtime is sufficient.</span></span>  

## <span data-ttu-id="abd67-124">Gerenciamento de memória</span><span class="sxs-lookup"><span data-stu-id="abd67-124">Memory management</span></span>  

<span data-ttu-id="abd67-125">JavaScript é uma linguagem coletada pelo Garbage Collector e, portanto, há várias considerações que devem ser mantidas em mente ao trabalhar com APIs do JsRT a partir de outro idioma.</span><span class="sxs-lookup"><span data-stu-id="abd67-125">JavaScript is a garbage collected language, and thus there are several considerations that must be kept in mind when working with the JsRT APIs from another language.</span></span>  

<span data-ttu-id="abd67-126">A principal consideração é que o coletor de lixo JavaScript só pode ver referências a valores em dois locais: o heap do tempo de execução e a pilha.</span><span class="sxs-lookup"><span data-stu-id="abd67-126">The main consideration is that the JavaScript garbage collector can only see references to values in two places: its runtime's heap, and the stack.</span></span> <span data-ttu-id="abd67-127">Portanto, uma referência a um valor de JavaScript armazenado dentro de outro valor JavaScript ou em uma variável local na pilha será sempre vista pelo coletor de lixo.</span><span class="sxs-lookup"><span data-stu-id="abd67-127">Thus, a reference to a JavaScript value that is stored inside of another JavaScript value or in a local variable on the stack will always be seen by the garbage collector.</span></span> <span data-ttu-id="abd67-128">Mas as referências armazenadas em outros locais, como heaps gerenciadas pelo host ou sistema, não serão vistas pelo coletor de lixo e podem resultar em uma coleção prematuro de valores que ainda estão em uso pelo host.</span><span class="sxs-lookup"><span data-stu-id="abd67-128">But references stored in other locations, such as heaps managed by the host or the system, will not be seen by the garbage collector and may result in premature collection of values that are still in use by the host.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="abd67-129">Alguns compiladores de idiomas (como o compilador do Visual Studio C++) otimizarão as variáveis locais sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="abd67-129">Some language compilers (such as the Visual Studio C++ compiler) will optimize away local variables where possible.</span></span> <span data-ttu-id="abd67-130">Deve-se ter cuidado para garantir que as variáveis locais que fazem referência a valores JavaScript estejam na pilha se esperarem manter esses valores ativos.</span><span class="sxs-lookup"><span data-stu-id="abd67-130">Care must be taken to ensure that local variables that reference JavaScript values are on the stack if they are expected to keep those values alive.</span></span>  

<span data-ttu-id="abd67-131">Se uma referência a um valor de JavaScript for armazenada em um local não visível para o coletor de lixo, o host deve adicionar e remover manualmente referências usando as APIs JsRT.</span><span class="sxs-lookup"><span data-stu-id="abd67-131">If a reference to a JavaScript value will be stored in a location not visible to the garbage collector, the host must manually add and remove references using the JsRT APIs.</span></span>  

## <span data-ttu-id="abd67-132">Manipulação de exceções</span><span class="sxs-lookup"><span data-stu-id="abd67-132">Exception handling</span></span>  

<span data-ttu-id="abd67-133">Quando ocorre uma exceção JavaScript durante a execução do script, o tempo de execução contido é colocado em um estado de exceção.</span><span class="sxs-lookup"><span data-stu-id="abd67-133">When a JavaScript exception occurs during script execution, the containing runtime is put into an exception state.</span></span> <span data-ttu-id="abd67-134">Durante um estado de exceção, nenhum código pode ser executado e todas as chamadas de API falharão com o código de erro `JsErrorInExceptionState` até que o host recupere e limpe a exceção usando a `JsGetAndClearException` API.</span><span class="sxs-lookup"><span data-stu-id="abd67-134">While in an exception state, no code can run and all API calls will fail with the error code `JsErrorInExceptionState` until the host retrieves and clears the exception using the `JsGetAndClearException` API.</span></span> <span data-ttu-id="abd67-135">Se o host retornar de um retorno de chamada JavaScript sem limpar o tempo de execução de um estado de exceção, a exceção JavaScript será lançada novamente assim que o controle passar de volta para o mecanismo JavaScript.</span><span class="sxs-lookup"><span data-stu-id="abd67-135">If the host returns from a JavaScript callback without clearing the runtime from an exception state, then the JavaScript exception will be re-thrown as soon as control passes back to the JavaScript engine.</span></span> <span data-ttu-id="abd67-136">Isso também permite que os retornos de chamada do host "acionem" uma exceção JavaScript definindo o tempo de execução em um estado de exceção e, em seguida, retornando de um retorno de chamada do host.</span><span class="sxs-lookup"><span data-stu-id="abd67-136">This also enables host callbacks to "throw" a JavaScript exception by setting the runtime into an exception state and then returning from a host callback.</span></span>  

<span data-ttu-id="abd67-137">Um host não tem permissão para permitir que suas próprias exceções internas sejam propagadas em um retorno de chamada do host – qualquer método de retorno de chamada deve detectar todas as exceções de host antes de retornar o controle ao Runtime.</span><span class="sxs-lookup"><span data-stu-id="abd67-137">A host is not allowed to let its own internal exceptions to propagate across a host callback—any callback methods must catch all host exceptions before returning control to the runtime.</span></span>  

## <span data-ttu-id="abd67-138">Uso de recursos de tempo de execução</span><span class="sxs-lookup"><span data-stu-id="abd67-138">Runtime resource usage</span></span>  

<span data-ttu-id="abd67-139">As APIs do JsRT expõem uma série de como monitorar e modificar o modo em que os tempos de execução usam recursos.</span><span class="sxs-lookup"><span data-stu-id="abd67-139">The JsRT APIs expose a number of way to monitor and modify the way runtimes use resources.</span></span> <span data-ttu-id="abd67-140">Eles geralmente dividem-se nas seguintes categorias:</span><span class="sxs-lookup"><span data-stu-id="abd67-140">They generally break down into the following categories:</span></span>  

*   <span data-ttu-id="abd67-141">**Uso de thread**.</span><span class="sxs-lookup"><span data-stu-id="abd67-141">**Thread Usage**.</span></span> <span data-ttu-id="abd67-142">Por padrão, cada tempo de execução criará um thread de compilador JIT dedicado e um thread GC dedicado que servirá de acordo com o tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-142">By default, each runtime will create a dedicated JIT compiler thread and a dedicated GC thread that service that runtime.</span></span> <span data-ttu-id="abd67-143">Se um tempo de execução for criado com o `JsRuntimeAttributeDisableBackgroundWork` sinalizador, o trabalho JIT e GC será executado no próprio thread do tempo de execução, em vez de threads de segundo plano separados para cada um deles.</span><span class="sxs-lookup"><span data-stu-id="abd67-143">If a runtime is created with the `JsRuntimeAttributeDisableBackgroundWork` flag, then the JIT and GC work will be performed on the runtime thread itself instead of separate background threads for each one of them.</span></span> <span data-ttu-id="abd67-144">Um host também pode fornecer um retorno de chamada de serviço de thread para a `JsCreateRuntime` chamada, o que permitirá que o host agende o JIT e o GC funcione de maneira adequada.</span><span class="sxs-lookup"><span data-stu-id="abd67-144">A host can also supply a thread service callback to the `JsCreateRuntime` call, which will allow the host to schedule JIT and GC work in any way it sees fit.</span></span>
*   <span data-ttu-id="abd67-145">**Uso de memória**.</span><span class="sxs-lookup"><span data-stu-id="abd67-145">**Memory Usage**.</span></span> <span data-ttu-id="abd67-146">Há várias maneiras de monitorar e modificar o uso da memória de um tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-146">There are several ways to monitor and modify the memory usage of a runtime.</span></span> <span data-ttu-id="abd67-147">Se o tempo de execução estiver em execução por muito tempo, o host poderá especificar o `JsRuntimeAttributeEnableIdleProcessing` sinalizador ao criar o tempo de execução e, em seguida, chamar `JsIdle` quando o host estiver em um estado ocioso.</span><span class="sxs-lookup"><span data-stu-id="abd67-147">If the runtime will be running for a long time, the host can specify the `JsRuntimeAttributeEnableIdleProcessing` flag when creating the runtime and then call `JsIdle` when the host is in an idle state.</span></span> <span data-ttu-id="abd67-148">Isso permite que o mecanismo adie alguns trabalhos de limpeza e escrituração de memória até o tempo ocioso.</span><span class="sxs-lookup"><span data-stu-id="abd67-148">This allows the engine to defer some memory cleanup and bookkeeping work until idle time.</span></span>  
    
    <span data-ttu-id="abd67-149">O host pode monitorar as coletas de lixo chamando `JsSetRuntimeBeforeCollectCallback` .</span><span class="sxs-lookup"><span data-stu-id="abd67-149">The host can monitor garbage collections by calling `JsSetRuntimeBeforeCollectCallback`.</span></span> <span data-ttu-id="abd67-150">Ele também pode monitorar as atribuições feitas pelo heap chamando `JsSetRuntimeMemoryAllocationCallback` .</span><span class="sxs-lookup"><span data-stu-id="abd67-150">It can also monitor allocations made by the heap by calling `JsSetRuntimeMemoryAllocationCallback`.</span></span> <span data-ttu-id="abd67-151">Observe que essa API não chama novamente todas as atribuições de JavaScript, apenas quando a pilha do tempo de execução precisa de mais espaço do qual atribuir.</span><span class="sxs-lookup"><span data-stu-id="abd67-151">Note that this API does not call back on every JavaScript allocation, just when the runtime's heap needs more space from which to allocate.</span></span> <span data-ttu-id="abd67-152">O retorno de chamada de alocação de memória tem permissão para recusar a solicitação, que acionará uma coleta de lixo e, se não houver memória disponível, um erro de falta de memória no tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-152">The memory allocation callback is allowed to deny the request, which will trigger a garbage collection and, if no memory is available, an out of memory error in the runtime.</span></span>  
    
    <span data-ttu-id="abd67-153">O host também pode chamar `JsSetRuntimeMemoryLimit` para definir um limite para a quantidade de memória que um tempo de execução pode usar.</span><span class="sxs-lookup"><span data-stu-id="abd67-153">The host can also call `JsSetRuntimeMemoryLimit` to set a limit for how much memory a runtime can use.</span></span> <span data-ttu-id="abd67-154">Quando um tempo de execução atinge um limite, ele aciona uma coleta de lixo e, se não houver memória disponível, um erro de falta de memória será lançado pelo tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-154">When a runtime hits a limit, it will trigger a garbage collection and, if no memory is available, an out of memory error will be thrown by the runtime.</span></span>  
    
*   <span data-ttu-id="abd67-155">**Interrupções e avaliações de script**.</span><span class="sxs-lookup"><span data-stu-id="abd67-155">**Script Interruption and Evaluation**.</span></span> <span data-ttu-id="abd67-156">O host pode chamar `JsDisableRuntimeExecution` para terminar a execução dentro de um tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="abd67-156">The host can call `JsDisableRuntimeExecution` to terminate execution within a runtime.</span></span> <span data-ttu-id="abd67-157">Esta chamada pode ser feita a qualquer momento e a partir de qualquer thread.</span><span class="sxs-lookup"><span data-stu-id="abd67-157">This call can be made at any time and from any thread.</span></span> <span data-ttu-id="abd67-158">Como a terminação de script depende de atingir pontos de proteção inseridos no código, um script não pode terminar no momento exato, mas fará isso logo em seguida.</span><span class="sxs-lookup"><span data-stu-id="abd67-158">Because script termination depends on reaching guard points inserted into the code, a script may not terminate at the exact moment, but will do so very shortly afterwards.</span></span> <span data-ttu-id="abd67-159">Por padrão, os pontos de proteção de término são colocados no código gerado de modo conservador e podem não cobrir todas as situações, como um loop infinito.</span><span class="sxs-lookup"><span data-stu-id="abd67-159">By default, termination guard points are placed in the generated code conservatively and may not cover every situation, such as an infinite loop.</span></span> <span data-ttu-id="abd67-160">A criação do tempo de execução com o `JsRuntimeAttributeAllowScriptInterrupt` sinalizador faz com que o tempo de execução insira verificações adicionais de loops infinitos, muitas vezes pelo custo de uma pequena sobrecarga de desempenho.</span><span class="sxs-lookup"><span data-stu-id="abd67-160">Creating the runtime with the `JsRuntimeAttributeAllowScriptInterrupt` flag causes the runtime to insert additional checks for infinite loops, often at the cost of a small performance overhead.</span></span>  
    
    <span data-ttu-id="abd67-161">Se um host quiser impedir a geração de código nativo pelo compilador JIT, ele poderá especificar o `JsRuntimeAttributeDisableNativeCodeGeneration` sinalizador.</span><span class="sxs-lookup"><span data-stu-id="abd67-161">If a host wishes to disallow generation of native code by the JIT compiler, it can specify the `JsRuntimeAttributeDisableNativeCodeGeneration` flag.</span></span> <span data-ttu-id="abd67-162">Um host também pode impedir que os scripts executem scripts dinamicamente especificando o `JsRuntimeAttributeDisableEval` sinalizador.</span><span class="sxs-lookup"><span data-stu-id="abd67-162">A host can also disallow scripts from dynamically running scripts itself by specifying the `JsRuntimeAttributeDisableEval` flag.</span></span>  
    
## <span data-ttu-id="abd67-163">Depuração e criação de perfil</span><span class="sxs-lookup"><span data-stu-id="abd67-163">Debugging and profiling</span></span>  

<span data-ttu-id="abd67-164">As APIs do JsRT dão suporte à depuração e ao profiling por meio da tecnologia de script ativo.</span><span class="sxs-lookup"><span data-stu-id="abd67-164">JsRT APIs supports debugging and profiling via the Active Scripting technology.</span></span>  

<span data-ttu-id="abd67-165">A partir do Windows 10, o mecanismo de JavaScript Chakra dá suporte ao mecanismo do Internet Explorer (MSHTML) herdado e ao novo mecanismo Microsoft Edge (EdgeHTML), e você pode direcionar no JsRT (consulte [direcionando o Microsoft Edge versus mecanismos herdados](../chakra-hosting/targeting-edge-vs-legacy-engines-in-jsrt-apis.md) para obter detalhes).</span><span class="sxs-lookup"><span data-stu-id="abd67-165">Starting in Windows 10, the Chakra JavaScript Engine supports the legacy Internet Explorer (MSHTML) engine and new Microsoft Edge (EdgeHTML) engine, and you can target either in JsRT (see [Targeting Microsoft Edge vs. Legacy Engines](../chakra-hosting/targeting-edge-vs-legacy-engines-in-jsrt-apis.md) for details).</span></span> <span data-ttu-id="abd67-166">A depuração de um script no Visual Studio funciona de forma diferente entre o mecanismo herdado e o mecanismo do Microsoft Edge.</span><span class="sxs-lookup"><span data-stu-id="abd67-166">Debugging a script in Visual Studio works differently between the legacy engine and Microsoft Edge engine.</span></span> <span data-ttu-id="abd67-167">Com o mecanismo herdado, o host precisa fornecer um ponteiro de [interface IDebugApplication](/scripting/winscript/reference/idebugapplication-interface) , que pode ser obtido de uma instância de [interface IProcessDebugManager](/scripting/winscript/reference/iprocessdebugmanager-interface) .</span><span class="sxs-lookup"><span data-stu-id="abd67-167">With the legacy engine, the host needs to provide an [IDebugApplication Interface](/scripting/winscript/reference/idebugapplication-interface) pointer, which can be obtained from an [IProcessDebugManager Interface](/scripting/winscript/reference/iprocessdebugmanager-interface) instance.</span></span> <span data-ttu-id="abd67-168">Com o mecanismo Microsoft Edge, `IDebugApplication` está obsoleto, e o mecanismo Chakra permite recursos de depuração nativa e de script por meio do depurador do Visual Studio sem exigir uma implementação do `IDebugApplication` usuário.</span><span class="sxs-lookup"><span data-stu-id="abd67-168">With the Microsoft Edge engine, `IDebugApplication` is deprecated, and the Chakra engine enables native and script debugging capabilities through the Visual Studio debugger without requiring an implementation of `IDebugApplication` from the user.</span></span>  

<span data-ttu-id="abd67-169">Para criar scripts em um debuggable de contexto de execução, o mecanismo de Chakra precisa alternar para usar métodos de execução de código menos eficientes.</span><span class="sxs-lookup"><span data-stu-id="abd67-169">To make scripts in an execution context debuggable, the Chakra engine has to switch to using less efficient code execution methods.</span></span> <span data-ttu-id="abd67-170">Assim, o código debuggable geralmente é executado de forma mais lenta do que o código não debuggable.</span><span class="sxs-lookup"><span data-stu-id="abd67-170">As such, debuggable code typically runs slower than non-debuggable code.</span></span> <span data-ttu-id="abd67-171">Como resultado, com o mecanismo herdado, um host pode optar por iniciar a depuração em um contexto de execução desde o início fornecendo o `IDebugApplication` ponteiro para cima `JsCreateContext` , ou pode aguardar até que a depuração seja necessária e, em seguida, chamar `JsStartDebugging` .</span><span class="sxs-lookup"><span data-stu-id="abd67-171">As a result, with the legacy engine, a host can choose to either start debugging in an execution context from the beginning by providing the `IDebugApplication` pointer up front through `JsCreateContext`, or it can wait until debugging is needed and then call `JsStartDebugging`.</span></span> <span data-ttu-id="abd67-172">Com o mecanismo Microsoft Edge, você `JsCreateContext` não obtém mais um `IDebugApplication` parâmetro e, como resultado, o script é debuggable somente após `JsStartDebugging` ser chamado.</span><span class="sxs-lookup"><span data-stu-id="abd67-172">With the Microsoft Edge engine, `JsCreateContext` no longer takes an `IDebugApplication` parameter, and as a result the script is debuggable only after `JsStartDebugging` is called.</span></span> <span data-ttu-id="abd67-173">Durante a depuração usando o Visual Studio, a opção do depurador "script" deve estar habilitada.</span><span class="sxs-lookup"><span data-stu-id="abd67-173">When debugging using Visual Studio, the "Script" debugger option must be enabled.</span></span>  

<span data-ttu-id="abd67-174">O código JavaScript em um contexto de execução pode ser profiledo de uma das duas maneiras.</span><span class="sxs-lookup"><span data-stu-id="abd67-174">The JavaScript code in an execution context can be profiled in one of two ways.</span></span> <span data-ttu-id="abd67-175">A linha de comando do Visual Studio Profiler (vsperf.exe) pode ser usada no Windows 8,1 e em versões posteriores com a opção/js para produzir um relatório direcionado ao código JavaScript executado no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="abd67-175">The command line Visual Studio Profiler (vsperf.exe) can be used in Windows 8.1 and later versions with the /js switch to produce a report that targets the JavaScript code run in the application.</span></span> <span data-ttu-id="abd67-176">Ou o host pode chamar diretamente `JsStartProfiling` e `JsStopProfiling` fornecer um retorno de chamada para fazer o próprio profiling.</span><span class="sxs-lookup"><span data-stu-id="abd67-176">Or the host can directly call `JsStartProfiling` and `JsStopProfiling` and provide a callback to do profiling itself.</span></span> <span data-ttu-id="abd67-177">O host também pode examinar o estado da pilha coletada pelo Garbage ao chamar `JsEnumerateHeap` .</span><span class="sxs-lookup"><span data-stu-id="abd67-177">The host can also examine the state of the garbage collected heap by calling `JsEnumerateHeap`.</span></span> <span data-ttu-id="abd67-178">A criação de perfil no JsRT funciona da mesma maneira entre o mecanismo herdado e o Microsoft Edge Engine.</span><span class="sxs-lookup"><span data-stu-id="abd67-178">Profiling in JsRT works in the same manner between the legacy and the Microsoft Edge engine.</span></span> <span data-ttu-id="abd67-179">No entanto, as APIs de criação de perfil do JsRT ( `JsStartProfiling` , `JsStopProfiling` ,, `JsEnumerateHeap` e `JsIsEnumeratingHeap` ) não estão disponíveis para aplicativos universais do Windows.</span><span class="sxs-lookup"><span data-stu-id="abd67-179">However, JsRT profiling APIs (`JsStartProfiling`, `JsStopProfiling`, `JsEnumerateHeap`, and `JsIsEnumeratingHeap`) are not available for Universal Windows Apps.</span></span>  

<a name="Windows"></a>   

## <span data-ttu-id="abd67-180">JsRT e a plataforma universal do Windows</span><span class="sxs-lookup"><span data-stu-id="abd67-180">JsRT and the Universal Windows Platform</span></span>  

<span data-ttu-id="abd67-181">Você pode usar APIs JsRT para adicionar recursos de script a um aplicativo universal do Windows.</span><span class="sxs-lookup"><span data-stu-id="abd67-181">You can use JsRT APIs to add scripting capabilities to a Universal Windows app.</span></span> <span data-ttu-id="abd67-182">Um aplicativo universal do Windows que usa as APIs JsRT precisará direcionar as APIs do Microsoft Edge JSRT, que, por sua vez, direcionam o mecanismo Chakra do Edge.</span><span class="sxs-lookup"><span data-stu-id="abd67-182">A Universal Windows app that uses the JsRT APIs will need to target the Microsoft Edge JSRT APIs, which in turn target the Edge Chakra engine.</span></span> <span data-ttu-id="abd67-183">Para obter mais informações, consulte [direcionar mecanismos do Microsoft Edge versus Legacy](../chakra-hosting/targeting-edge-vs-legacy-engines-in-jsrt-apis.md).</span><span class="sxs-lookup"><span data-stu-id="abd67-183">For more information, see [Targeting Microsoft Edge vs. Legacy Engines](../chakra-hosting/targeting-edge-vs-legacy-engines-in-jsrt-apis.md).</span></span> <span data-ttu-id="abd67-184">A API JsRT completa está disponível para aplicativos universais do Windows, exceto para a criação de perfil e suporte à enumeração de heap ( `JsStartProfiling` ,, `JsStopProfiling` `JsEnumerateHeap` e `JsIsEnumeratingHeap` não são suportados).</span><span class="sxs-lookup"><span data-stu-id="abd67-184">The complete JsRT API is available for Universal Windows apps, except for profiling and heap enumeration support (`JsStartProfiling`, `JsStopProfiling`, `JsEnumerateHeap`, and `JsIsEnumeratingHeap` are not supported).</span></span>  

<span data-ttu-id="abd67-185">O JsRT também permite que os scripts acessem nativamente todas as [APIs da plataforma universal do Windows (UWP)](https://msdn.microsoft.com/library/windows/apps/br211377.aspx) depois de expor o namespace da API por meio da API do Microsoft Edge JsRT `JsProjectWinRTNamespace` .</span><span class="sxs-lookup"><span data-stu-id="abd67-185">JsRT also allows scripts to natively access any [Universal Windows Platform (UWP) APIs](https://msdn.microsoft.com/library/windows/apps/br211377.aspx) after exposing the API namespace through Microsoft Edge JsRT API `JsProjectWinRTNamespace`.</span></span> <span data-ttu-id="abd67-186">Embora os aplicativos universais do Windows não exijam configuração, além da projeção de namespaces necessários, em um aplicativo do Windows clássico (Win32), um mecanismo de bombeamento delegado inicializado COM deve ser habilitado `JsSetProjectionEnqueueCallback` para habilitar eventos e APIs assíncronas.</span><span class="sxs-lookup"><span data-stu-id="abd67-186">While Universal Windows Applications require no setup in addition to projecting necessary namespaces, in a Classic (Win32) Windows Application, a COM-initialized delegated pumping mechanism needs to be enabled through `JsSetProjectionEnqueueCallback` to enable events and asynchronous APIs.</span></span> <span data-ttu-id="abd67-187">O exemplo de Win32 a seguir usa APIs UWP assíncronas para criar um cliente http para obter conteúdo de um URI:</span><span class="sxs-lookup"><span data-stu-id="abd67-187">The following Win32 sample utilizes asynchronous UWP APIs to create an http client to get content from a Uri:</span></span>  

```cpp
typedef struct _jsCall {
    JsProjectionCallback jsCallback;
    JsProjectionCallbackContext jsContext;
    HANDLE event;
} jsCall;

// Set up delegated pumping mechanism; not necessary in UWP applications.
jsCall outstandingCall = {};
CoInitializeEx(nullptr, COINIT_MULTITHREADED);
JsSetProjectionEnqueueCallback([](JsProjectionCallback jsCallback,
JsProjectionCallbackContext jsContext, void *callbackState) {
    jsCall* call = (jsCall*)callbackState;
    call->jsCallback = jsCallback;
    call->jsContext = jsContext;
    SetEvent(call->event);
    },
&outstandingCall);
HANDLE event = CreateEventEx(NULL, NULL, CREATE_EVENT_MANUAL_RESET, EVENT_ALL_ACCESS);
outstandingCall.event = event;

// Project necessary namespaces.
JsProjectWinRTNamespace(L"Windows.Foundation");
JsProjectWinRTNamespace(L"Windows.Web");

// Get content from an Uri.
JsRunScript(L"var uri = new Windows.Foundation.Uri(\"http://somedatasource.com\"); " \
    L"var httpClient = new Windows.Web.Http.HttpClient();" \
    L"httpClient.getStringAsync(uri).done(function (content) { " \
    L"    // do something with the string content " \
    L"}, onError); " \
    L"function onError(reason) { " \
    L"    // error handling " \
    L"}",
    currentSourceContext, L"", &result);

// Wait for async call to come in and then execute; not necessary in UWP applications.
WaitForSingleObjectEx(outstandingCall.event, 10000, FALSE) == WAIT_OBJECT_0;
outstandingCall.jsCallback(outstandingCall.jsContext);
```  

## <span data-ttu-id="abd67-188">Consulte também</span><span class="sxs-lookup"><span data-stu-id="abd67-188">See also</span></span>  

*   [<span data-ttu-id="abd67-189">Aplicativo de exemplo do tempo de execução JavaScript</span><span class="sxs-lookup"><span data-stu-id="abd67-189">JavaScript Runtime Sample App</span></span>](https://go.microsoft.com/fwlink/p/?LinkID=306674&clcid=0x409)   
*   [<span data-ttu-id="abd67-190">Referência (Runtime do JavaScript)</span><span class="sxs-lookup"><span data-stu-id="abd67-190">Reference (JavaScript Runtime)</span></span>](../chakra-hosting/reference-javascript-runtime.md)   
*   [<span data-ttu-id="abd67-191">Hospedagem de Runtime no JavaScript</span><span class="sxs-lookup"><span data-stu-id="abd67-191">JavaScript Runtime Hosting</span></span>](../javascript-runtime-hosting.md)  
